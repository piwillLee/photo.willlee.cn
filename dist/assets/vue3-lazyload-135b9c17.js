import"./vue-feca26f7.js";var a=(o=>(o.LOADING="loading",o.LOADED="loaded",o.ERROR="error",o))(a||{});const O=typeof window<"u"&&window!==null,_=l(),g=Object.prototype.propertyIsEnumerable,A=Object.getOwnPropertySymbols;function b(o){return typeof o=="function"||toString.call(o)==="[object Object]"}function m(o){return typeof o=="object"?o===null:typeof o!="function"}function I(o){return o!=="__proto__"&&o!=="constructor"&&o!=="prototype"}function l(){return O&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function w(o,...t){if(!b(o))throw new TypeError("expected the first argument to be an object");if(t.length===0||typeof Symbol!="function"||typeof A!="function")return o;for(const e of t){const r=A(e);for(const i of r)g.call(e,i)&&(o[i]=e[i])}return o}function p(o,...t){let e=0;for(m(o)&&(o=t[e++]),o||(o={});e<t.length;e++)if(b(t[e])){for(const r of Object.keys(t[e]))I(r)&&(b(o[r])&&b(t[e][r])?p(o[r],t[e][r]):o[r]=t[e][r]);w(o,t[e])}return o}const f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",v="",y={rootMargin:"0px",threshold:0},u="data-lazy-timeout-id";class E{constructor(t){this.options={loading:f,error:v,observerOptions:y,log:!0,lifecycle:{}},this._images=new WeakMap,this.config(t)}config(t={}){p(this.options,t)}mount(t,e){if(!t)return;const{src:r,loading:i,error:s,lifecycle:n,delay:c}=this._valueFormatter(typeof e=="string"?e:e.value);this._lifecycle(a.LOADING,n,t),t.setAttribute("src",i||f),_||(this.loadImages(t,r,s,n),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(t,r,s,n,c)}update(t,e){var c;if(!t)return;(c=this._realObserver(t))==null||c.unobserve(t);const{src:r,error:i,lifecycle:s,delay:n}=this._valueFormatter(typeof e=="string"?e:e.value);this._initIntersectionObserver(t,r,i,s,n)}unmount(t){var e;t&&((e=this._realObserver(t))==null||e.unobserve(t),this._images.delete(t))}loadImages(t,e,r,i){this._setImageSrc(t,e,r,i)}_setImageSrc(t,e,r,i){t.tagName.toLowerCase()==="img"?(e&&t.getAttribute("src")!==e&&t.setAttribute("src",e),this._listenImageStatus(t,()=>{this._lifecycle(a.LOADED,i,t)},()=>{var s;t.onload=null,this._lifecycle(a.ERROR,i,t),(s=this._realObserver(t))==null||s.disconnect(),r&&t.getAttribute("src")!==r&&t.setAttribute("src",r),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${e} `)})})):t.style.backgroundImage=`url('${e}')`}_initIntersectionObserver(t,e,r,i,s){var c;const n=this.options.observerOptions;this._images.set(t,new IntersectionObserver(h=>{Array.prototype.forEach.call(h,d=>{s&&s>0?this._delayedIntersectionCallback(t,d,s,e,r,i):this._intersectionCallback(t,d,e,r,i)})},n)),(c=this._realObserver(t))==null||c.observe(t)}_intersectionCallback(t,e,r,i,s){var n;e.isIntersecting&&((n=this._realObserver(t))==null||n.unobserve(e.target),this._setImageSrc(t,r,i,s))}_delayedIntersectionCallback(t,e,r,i,s,n){if(e.isIntersecting){if(e.target.hasAttribute(u))return;const c=setTimeout(()=>{this._intersectionCallback(t,e,i,s,n),e.target.removeAttribute(u)},r);e.target.setAttribute(u,String(c))}else e.target.hasAttribute(u)&&(clearTimeout(Number(e.target.getAttribute(u))),e.target.removeAttribute(u))}_listenImageStatus(t,e,r){t.onload=e,t.onerror=r}_valueFormatter(t){let e=t,r=this.options.loading,i=this.options.error,s=this.options.lifecycle,n=this.options.delay;return b(t)&&(e=t.src,r=t.loading||this.options.loading,i=t.error||this.options.error,s=t.lifecycle||this.options.lifecycle,n=t.delay||this.options.delay),{src:e,loading:r,error:i,lifecycle:s,delay:n}}_log(t){this.options.log&&t()}_lifecycle(t,e,r){switch(t){case a.LOADING:r==null||r.setAttribute("lazy",a.LOADING),e!=null&&e.loading&&e.loading(r);break;case a.LOADED:r==null||r.setAttribute("lazy",a.LOADED),e!=null&&e.loaded&&e.loaded(r);break;case a.ERROR:r==null||r.setAttribute("lazy",a.ERROR),e!=null&&e.error&&e.error(r);break}}_realObserver(t){return this._images.get(t)}}const D={install(o,t){const e=new E(t);o.config.globalProperties.$Lazyload=e,o.provide("Lazyload",e),o.directive("lazy",{mounted:e.mount.bind(e),updated:e.update.bind(e),unmounted:e.unmount.bind(e)})}};export{D as i};
